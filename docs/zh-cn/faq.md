# 常见问题

## 问题

### 需要我们来确定消息是否被另外一个客户端消费过么？

clinet ID 一般的 mqtt 库。如果不明确指定 clinet ID 都是随机生产的。

消费是一致的。对于是否会被其他客户端消费过。
mqtt 本身无法保证这一点，取决于上层的实现，对于消费着，我们在  clinet ID 上进行了限制，
比如有 nodes/1/jsonrpc 明确指定只有 client ID 为 1 的才能 sub 。但 client ID 为 1 的同一时刻只能存在一个

### 如果出现clinet 断开连接再重连， 会消费堆积的消息么？

这个是 mqtt 本身的问题，如果 mqtt broker 识别到断开。会清除掉 sub 的状态，这个时候再发送消息会直接丢弃的。
如果是网络抖动的断开重连，会消费堆积的消息，我们一般做法是判断 status 然后再发送消息，
中途如果接收到 will meassage 可以认为请求没有接受到，的等待连接之后重新发送消息即可。
（这里要注意：这个对应的 jsonrpc 消息，id 要和之前的保持一直。接收者会自动过滤掉 相同的请求。）

### 我们发送消息的频率如果高于获取遥测信息的频率，重复的命令你们是怎么处理的，比如我连续发送多次切换到自动状态，直到我获取到无人机状态为自动 会出现问题么

关于重复的命令，这个分成两种情况：

1. 完全相同的 jsonrpc 请求。这个会自动过滤掉，jsonrpc ID 相同可以认为是同一条命令。
2. jsonrpc ID 不同的情况，这个会堵在队列了一条一条的执行。（不过对于这种情况可以使用 jsonrpc 的 Notification 来发送请求）

### 调整焦距后，云台的旋转速度会自适应么？

目前没有适应，焦距状态会回传，可以根据回传结果发送不同速度的控制命令。

### 有类似让无人机北偏东 30 度飞行的命令么

目前飞行分为两种：

1. 一种是按照上传好的航点，无人机一个个飞行
2. 另一种是设定一个目标GPS点，它会往这个方向去飞行。

所以要让无人机北偏东 30 度飞行，可以根据无人机当前 GPS 计算出一个北偏东 30 度的 GPS，指令发过去后，它就会按这个方向去飞行，直到抵达目标 GPS 点

